var cookApp=angular.module("cookApp",["ngRoute","Controllers"]);angular.module("Controllers",["ngCookies"]).run(["$http","$rootScope","$cookies",function(e,t,r){t.current_user=r.current_user,t.authenticated=r.authenticated;var a=JSON.parse(localStorage.getItem("filtered_recipes"));t.filtered_recipes=a;var n=JSON.parse(localStorage.getItem("unique_recipe"));t.unique_recipe=n;var i=JSON.parse(localStorage.getItem("ingreds"));t.ingreds=i;var o=JSON.parse(localStorage.getItem("directions"));t.directions=o,t.show_edit=localStorage.getItem("show_edit"),t.logout=function(){e.get("/auth/signout"),t.authenticated=!1,t.current_user="",r.authenticated="false",r.current_user=""}}]).controller("mainCtrl",["$scope","$location","$http","$rootScope","$cookies","$window",function(e,t,r,a,n,i){function o(e){a.unique_recipe=e.data,a.ingreds=e.data.ingredients.split("\n"),a.directions=e.data.body.split("\n");var t=JSON.stringify(a.unique_recipe),r=JSON.stringify(a.ingreds),n=JSON.stringify(a.directions);localStorage.setItem("unique_recipe",t),localStorage.setItem("ingreds",r),localStorage.setItem("directions",n)}r.get("/api/recipes").then(function(e){a.recipes=e.data}),e.filter=function(t){r.get("api/recipes").then(function(r){var a=[];if("user"==t)for(i=0;i<r.data.length;i++)r.data[i].posted_by==n.current_user&&a.push(r.data[i]);else for(var i=0;i<r.data.length;i++)r.data[i].type==t&&a.push(r.data[i]);e.filtered_recipes=a;var o=JSON.stringify(a);localStorage.setItem("filtered_recipes",o)},function(e){alert("There was an error. Please try again.\nStatusCode: "+e.status)})},e.show_recipe=function(e){var t=e._id;e.posted_by==n.current_user?(a.show_edit=!0,localStorage.setItem("show_edit","true")):(a.show_edit=!1,localStorage.setItem("show_edit","false")),r.get("/api/recipe/"+t).then(function(e){o(e)},function(e){alert("There was an error. Please try again.\nStatusCode: "+e.status)}),a.unique_recipe="",localStorage.removeItem("unique_recipe"),localStorage.removeItem("ingreds"),a.ingreds="",localStorage.removeItem("directions"),a.directions=""},e.addRecipe=function(){e.newRecipe.posted_by=a.current_user,r.post("/api/recipes",e.newRecipe).then(function(e){t.path("/"),i.scrollTo(0,0)},function(e){alert("There was an error. Please try again.\nStatusCode: "+e.status),t.path("/add_recipe")})},e.edit=function(n){r.get("/api/recipe/"+n._id).then(function(e){a.recipe=e.data,t.path("/edit_recipe")},function(e){t.path("/show_recipe"),a.recipe="",alert("There was an error. Please try again.\nStatusCode: "+e.status)}),e.recipes="",i.scrollTo(0,0)},e.save=function(){r.put("/api/recipe/"+e.recipe._id,e.recipe).then(function(e){o(e),t.path("/show_recipe")},function(e){alert("There was an error. Please try again.\nStatusCode: "+e.status),t.path("/edit_recipe")}),console.log("ddddd"),i.scrollTo(0,0)},e.delete=function(e){confirm("The recipe will be deleted! Procceed?")&&r.delete("/api/recipe/"+e._id).then(function(e){a.recipe="",t.path("/"),a.recipe=""},function(e){alert("There was an error. Please try again.\nStatusCode: "+e.status),t.path("/show_recipe")}),a.recipe="",i.scrollTo(0,0)},e.center_menu=!1,e.show_menu=function(){e.center_menu?e.center_menu=!1:e.center_menu=!0}}]).controller("authCtrl",["$scope","$location","$http","$rootScope","$cookies",function(e,t,r,a,n){e.user={username:"",email:"",password:""},e.register=function(){r.post("/auth/signup",e.user).success(function(e,r){"success"==e.state?(t.path("/"),alert("Registration successful. Now You can log in")):alert("Registration failed. User with such username already exists")})},e.login=function(){r.post("/auth/login",e.user).then(function(e){"success"==e.data.state&&(a.authenticated=!0,a.current_user=e.data.user.username,n.current_user=a.current_user,n.authenticated="true",t.path("/")),"failure"==e.data.state&&alert("Invalid username or password")},function(e){alert("There was an error. Please try again.\nStatusCode: "+e.status),t.path("/show_recipe")})}}]),cookApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"templates/main.html",controller:"mainCtrl"}).when("/register",{templateUrl:"templates/register.html",controller:"authCtrl"}).when("/login",{templateUrl:"templates/login.html",controller:"authCtrl"}).when("/add_recipe",{templateUrl:"templates/add_recipe.html",controller:"mainCtrl"}).when("/show_recipe",{templateUrl:"templates/show_recipe.html",controller:"mainCtrl"}).when("/filtered",{templateUrl:"templates/filtered.html",controller:"mainCtrl"}).when("/edit_recipe",{templateUrl:"templates/edit_recipe.html",controller:"mainCtrl"}),e.otherwise("/")}]);